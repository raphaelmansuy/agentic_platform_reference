.PHONY: help install start build serve clean typecheck deploy clear-cache

# Colors for output
BLUE = \033[0;34m
GREEN = \033[0;32m
YELLOW = \033[1;33m
RED = \033[0;31m
NC = \033[0m # No Color

# Default target - show help
help:
	@echo "$(BLUE)"
	@echo "â•”â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•—"
	@echo "â•‘                 ðŸ“š Docusaurus Site Manager                    â•‘"
	@echo "â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"
	@echo "$(NC)"
	@echo ""
	@echo "$(GREEN)ðŸ“¦ Installation$(NC)"
	@echo "  $(YELLOW)make install$(NC)          Install dependencies (npm install)"
	@echo ""
	@echo "$(GREEN)ðŸš€ Development$(NC)"
	@echo "  $(YELLOW)make start$(NC)            Start development server (localhost:3000)"
	@echo "  $(YELLOW)make stop$(NC)             Stop development server"
	@echo "  $(YELLOW)make clean$(NC)            Remove build artifacts and cache"
	@echo ""
	@echo "$(GREEN)ðŸ”¨ Building$(NC)"
	@echo "  $(YELLOW)make build$(NC)            Build for production"
	@echo "  $(YELLOW)make serve$(NC)            Serve production build locally"
	@echo "  $(YELLOW)make rebuild$(NC)          Clean and rebuild (fresh build)"
	@echo ""
	@echo "$(GREEN)ðŸ§ª Testing & Quality$(NC)"
	@echo "  $(YELLOW)make typecheck$(NC)        Run TypeScript type checking"
	@echo "  $(YELLOW)make verify$(NC)           Run all checks (typecheck + build test)"
	@echo ""
	@echo "$(GREEN)ðŸ§¹ Cleanup$(NC)"
	@echo "  $(YELLOW)make clear-cache$(NC)      Clear Docusaurus cache"
	@echo "  $(YELLOW)make clean-all$(NC)        Deep clean (node_modules, cache, build)"
	@echo ""
	@echo "$(GREEN)ðŸ“¤ Deployment$(NC)"
	@echo "  $(YELLOW)make deploy$(NC)           Deploy to GitHub Pages"
	@echo ""
	@echo "$(GREEN)â“ Help$(NC)"
	@echo "  $(YELLOW)make help$(NC)             Show this help message"
	@echo ""

# Install dependencies
install:
	@echo "$(BLUE)ðŸ“¦ Installing dependencies...$(NC)"
	npm install
	@echo "$(GREEN)âœ“ Dependencies installed!$(NC)"

# Start development server
start:
	@echo "$(BLUE)ðŸš€ Starting development server...$(NC)"
	@echo "$(YELLOW)â†’ Open http://localhost:3000$(NC)"
	npm run start

# Stop development server
stop:
	@echo "$(BLUE)â¹ï¸  Stopping development server...$(NC)"
	@pkill -f "docusaurus start" || echo "$(YELLOW)No running server found$(NC)"

# Build for production
build:
	@echo "$(BLUE)ðŸ”¨ Building for production...$(NC)"
	npm run build
	@echo "$(GREEN)âœ“ Build complete! Output in ./build/$(NC)"

# Serve production build locally
serve:
	@echo "$(BLUE)ðŸ“¦ Serving production build...$(NC)"
	@echo "$(YELLOW)â†’ Open http://localhost:3000$(NC)"
	npm run serve

# TypeScript checking
typecheck:
	@echo "$(BLUE)ðŸ” Running TypeScript checks...$(NC)"
	npm run typecheck
	@echo "$(GREEN)âœ“ All type checks passed!$(NC)"

# Clean build artifacts and cache
clean:
	@echo "$(BLUE)ðŸ§¹ Cleaning build artifacts...$(NC)"
	rm -rf build .docusaurus
	@echo "$(GREEN)âœ“ Cleaned build artifacts!$(NC)"

# Clear Docusaurus cache
clear-cache:
	@echo "$(BLUE)ðŸ’¨ Clearing Docusaurus cache...$(NC)"
	npm run clear
	@echo "$(GREEN)âœ“ Cache cleared!$(NC)"

# Clean everything including node_modules
clean-all: clean clear-cache
	@echo "$(BLUE)ðŸ—‘ï¸  Removing node_modules (this may take a moment)...$(NC)"
	rm -rf node_modules package-lock.json
	@echo "$(GREEN)âœ“ Deep clean complete!$(NC)"
	@echo "$(YELLOW)â†’ Run 'make install' to reinstall dependencies$(NC)"

# Fresh rebuild
rebuild: clean build
	@echo "$(GREEN)âœ“ Fresh build complete!$(NC)"

# Run all checks
verify: typecheck
	@echo "$(BLUE)ðŸ§ª Running build test...$(NC)"
	npm run build
	@echo "$(GREEN)âœ“ All checks passed! Site is ready to deploy.$(NC)"

# Deploy to GitHub Pages
deploy: verify
	@echo "$(BLUE)ðŸ“¤ Deploying to GitHub Pages...$(NC)"
	@echo "$(YELLOW)â†’ Make sure to commit and push to main branch$(NC)"
	@echo "$(YELLOW)â†’ GitHub Actions will handle the deployment$(NC)"
	@echo "$(GREEN)âœ“ Ready to deploy!$(NC)"

# Development workflow - common starting point
dev: install start

# Quick build and serve for testing
test: build serve

# Show environment info
info:
	@echo "$(BLUE)â„¹ï¸  Environment Information$(NC)"
	@echo "Node version: $$(node --version)"
	@echo "npm version: $$(npm --version)"
	@echo "Docusaurus: $$(npm list docusaurus 2>/dev/null | grep docusaurus | head -1 || echo 'Not found')"
	@echo ""
